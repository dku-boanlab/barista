<html>
<head>
<title>cbench/oflops/channel_info.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/1100.html'>cbench</a>/<a href='../files/1101.html'>oflops</a>/channel_info.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L20'>[^]</a><a href='#L180'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L20' title='Defined at 20.'>channel_info_init</a>
<li><a href='#L65' title='Defined at 65.'>setup_channel</a>
<li><a href='#L154' title='Defined at 154.'>my_read_objid</a>
<li><a href='#L180' title='Defined at 180.'>setup_channel_snmp</a>
</ol>
<hr>
<pre>
<a name='L1'>   1 <font color='darkred'>#include</font> &lt;assert.h&gt;
<a name='L2'>   2 <font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L3'>   3 <font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L4'>   4 <font color='darkred'>#include</font> &lt;string.h&gt;
<a name='L5'>   5 <font color='darkred'>#include</font> &lt;unistd.h&gt;
<a name='L6'>   6 
<a name='L7'>   7 <font color='darkred'>#include</font> &lt;arpa/inet.h&gt;
<a name='L8'>   8 
<a name='L9'>   9 <font color='darkred'>#include</font> &lt;linux/if_packet.h&gt;
<a name='L10'>  10 <font color='darkred'>#include</font> &lt;linux/if_ether.h&gt;
<a name='L11'>  11 <font color='darkred'>#include</font> &lt;<a href='312.html'>linux/if_arp.h</a>&gt;
<a name='L12'>  12 
<a name='L13'>  13 <font color='darkred'>#include</font> &lt;sys/ioctl.h&gt;
<a name='L14'>  14 <font color='darkred'>#include</font> &lt;sys/socket.h&gt;
<a name='L15'>  15 
<a name='L16'>  16 
<a name='L17'>  17 <font color='darkred'>#include</font> "<a href='33.html'>channel_info.h</a>"
<a name='L18'>  18 <font color='darkred'>#include</font> "<a href='17.html'>utils.h</a>"
<a name='L19'>  19 
<a name='L20'>  20 <b>int</b> <a href='../R/2335.html' title='Multiple refered from 5 places.'>channel_info_init</a>(<b>struct</b> <a href='../Y/1858.html' title='Multiple used in 2 places.'>channel_info</a> * <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>, <b>char</b> * <a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>)
<a name='L21'>  21 <font color='red'>{</font>
<a name='L22'>  22         <b>struct</b> <a href='../Y/3750.html' title='Multiple used in 47 places.'>ifreq</a> <a href='../Y/3740.html' title='Multiple used in 71 places.'>ifr</a>;
<a name='L23'>  23         <b>int</b> <a href='../Y/2598.html' title='Multiple used in 4 places.'>dumb</a>;
<a name='L24'>  24         <b>char</b> *<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>;
<a name='L25'>  25 
<a name='L26'>  26         <a href='../Y/1748.html' title='Multiple used in 31 places.'>bzero</a>(<a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>, <b>sizeof</b>(<a href='../D/7051.html' title='Multiple defined in 2 places.'>channel_info</a>));
<a name='L27'>  27         <b>if</b>((<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a> = <a href='../Y/3795.html' title='Multiple used in 107 places.'>index</a>(<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>, ':')) != <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>) <font color='red'>{</font>
<a name='L28'>  28           *<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a> = '\0';
<a name='L29'>  29           <a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>++;
<a name='L30'>  30           <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a> = <a href='../Y/1510.html' title='Multiple used in 76 places.'>atoi</a>(<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>);
<a name='L31'>  31         <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L32'>  32           <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a> = -1;
<a name='L33'>  33         <font color='red'>}</font>
<a name='L34'>  34         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/3766.html' title='Multiple used in 38 places.'>inOID_len</a> = <a href='../Y/538.html' title='Multiple used in 8 places.'>MAX_OID_LEN</a>;
<a name='L35'>  35         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5533.html' title='Multiple used in 61 places.'>outOID_len</a> = <a href='../Y/538.html' title='Multiple used in 8 places.'>MAX_OID_LEN</a>;
<a name='L36'>  36         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a> = <a href='../Y/7085.html' title='Multiple used in 28 places.'>strdup</a>(<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>);
<a name='L37'>  37         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5673.html' title='Multiple used in 5 places.'>pcap_fd</a> = -1;
<a name='L38'>  38         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/6251.html' title='Multiple used in 12 places.'>raw_sock</a> = -1;
<a name='L39'>  39         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/6894.html' title='Multiple used in 148 places.'>sock</a> = -1;
<a name='L40'>  40         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../S/252.html#L203' title='Defined at 203 in cbench/openflow/tests/test-stp.c.'>dump</a> = <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>;
<a name='L41'>  41 
<a name='L42'>  42         <i><font color='green'>/* Not sure why I need a socket to do this */</font></i>
<a name='L43'>  43         <a href='../Y/2598.html' title='Multiple used in 4 places.'>dumb</a> = <a href='../Y/6901.html' title='Multiple used in 21 places.'>socket</a>(<a href='../Y/18.html' title='Multiple used in 29 places.'>AF_INET</a>, <a href='../Y/830.html' title='Multiple used in 15 places.'>SOCK_STREAM</a>, 0);
<a name='L44'>  44 
<a name='L45'>  45         <i><font color='green'>/*retrieve ethernet interface index*/</font></i>
<a name='L46'>  46         <a href='../Y/7102.html' title='Multiple used in 59 places.'>strncpy</a>(<a href='../Y/3740.html' title='Multiple used in 71 places.'>ifr</a>.<a href='../Y/3748.html' title='Multiple used in 16 places.'>ifr_name</a>, <a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>, <a href='../Y/452.html' title='Multiple used in 17 places.'>IFNAMSIZ</a>);
<a name='L47'>  47         <b>if</b> (<a href='../Y/3867.html' title='Multiple used in 34 places.'>ioctl</a>(<a href='../Y/2598.html' title='Multiple used in 4 places.'>dumb</a>, <a href='../Y/814.html' title='Multiple used in 5 places.'>SIOCGIFINDEX</a>, &amp;<a href='../Y/3740.html' title='Multiple used in 71 places.'>ifr</a>) == -1) 
<a name='L48'>  48                 <a href='../S/122.html#L48' title='Defined at 48 in cbench/oflops/utils.c.'>perror_and_exit</a>("SIOCGIFINDEX",1);
<a name='L49'>  49 
<a name='L50'>  50         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/3735.html' title='Multiple used in 13 places.'>ifindex</a> = <a href='../Y/3740.html' title='Multiple used in 71 places.'>ifr</a>.<a href='../Y/3745.html' title='Multiple used in 5 places.'>ifr_ifindex</a>;
<a name='L51'>  51         <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5600.html' title='Multiple used in 4 places.'>packet_len</a> = 0;
<a name='L52'>  52     <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/5555.html' title='Multiple used in 3 places.'>outgoing</a> = <a href='../S/13.html#L17' title='Defined at 17 in cbench/oflops/msgbuf.c.'>msgbuf_new</a>(4096);   <i><font color='green'>// will get resized</font></i>
<a name='L53'>  53     <a href='../Y/1856.html' title='Multiple used in 30 places.'>channel</a>-&gt;<a href='../Y/2354.html' title='Multiple used in 338 places.'>det</a> = <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>;
<a name='L54'>  54     <a href='../Y/1918.html' title='Multiple used in 102 places.'>close</a>(<a href='../Y/2598.html' title='Multiple used in 4 places.'>dumb</a>);
<a name='L55'>  55     <b>return</b> 0;
<a name='L56'>  56 <font color='red'>}</font>
<a name='L57'>  57 
<a name='L58'>  58 <i><font color='green'>/****************************************************</font></i>
<a name='L59'>  59 <i><font color='green'> * query module if they want pcap and set it up for them if yes</font></i>
<a name='L60'>  60 <i><font color='green'> * also create a raw_socket bound to each device if we have the</font></i>
<a name='L61'>  61 <i><font color='green'> * device set</font></i>
<a name='L62'>  62 <i><font color='green'> */</font></i>
<a name='L63'>  63 
<a name='L64'>  64 
<a name='L65'>  65 <b>void</b> <a href='../R/4441.html' title='Multiple refered from 2 places.'>setup_channel</a>(<a href='../Y/5077.html' title='Multiple used in 258 places.'>oflops_context</a> *<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>, <a href='../Y/7314.html' title='Multiple used in 10 places.'>test_module</a> *<a href='../Y/4481.html' title='Multiple used in 122 places.'>mod</a>, <a href='../Y/5076.html' title='Multiple used in 49 places.'>oflops_channel_name</a> <a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a> )
<a name='L66'>  66 <font color='red'>{</font>
<a name='L67'>  67         <b>char</b> <a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>[<a href='../D/520.html' title='Multiple defined in 7 places.'>BUFLEN</a>];
<a name='L68'>  68         <b>char</b> <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>[PCAP_ERRBUF_SIZE];
<a name='L69'>  69         <b>struct</b> bpf_program <a href='../Y/3075.html' title='Multiple used in 66 places.'>filter</a>;
<a name='L70'>  70         bpf_u_int32 <a href='../Y/4338.html' title='Multiple used in 220 places.'>mask</a>=0, <a href='../Y/4697.html' title='Multiple used in 6 places.'>net</a>=0;
<a name='L71'>  71 
<a name='L72'>  72         <a href='../D/7051.html' title='Multiple defined in 2 places.'>channel_info</a> *<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a> = &amp;<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>];     
<a name='L73'>  73 
<a name='L74'>  74 
<a name='L75'>  75         <b>if</b>(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>==<a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>)  <i><font color='green'>// no device specified</font></i>
<a name='L76'>  76         <font color='red'>{</font>
<a name='L77'>  77                 <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a> = pcap_lookupdev(<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L78'>  78                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"%s channel %i not configured; guessing device: ",
<a name='L79'>  79                                 ((<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>==<a href='../S/55.html#L13' title='Defined at 13 in cbench/oflops/test_module.h.'>OFLOPS_CONTROL</a>)?"Control":"Data"), <a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>);
<a name='L80'>  80                 <b>if</b>(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>)
<a name='L81'>  81                         <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"%s",<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>);
<a name='L82'>  82                 <b>else</b>
<a name='L83'>  83                 <font color='red'>{</font>
<a name='L84'>  84                         <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, " pcap_lookup() failed: %s ; exiting....\n", <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L85'>  85                         <a href='../Y/2943.html' title='Multiple used in 74 places.'>exit</a>(1);
<a name='L86'>  86                 <font color='red'>}</font>
<a name='L87'>  87         <font color='red'>}</font>
<a name='L88'>  88 
<a name='L89'>  89         <i><font color='green'>// setup pcap filter, if wanted</font></i>
<a name='L90'>  90         <b>if</b>( <a href='../Y/4481.html' title='Multiple used in 122 places.'>mod</a>-&gt;<a href='../D/7984.html' title='Multiple defined in 16 places.'>get_pcap_filter</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>,<a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>,<a href='../D/520.html' title='Multiple defined in 7 places.'>BUFLEN</a>) &lt;=0)
<a name='L91'>  91         <font color='red'>{</font>
<a name='L92'>  92                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "Test %s:  No pcap filter for channel %d on %s\n",
<a name='L93'>  93                                 <a href='../Y/4481.html' title='Multiple used in 122 places.'>mod</a>-&gt;<a href='../D/8420.html' title='Multiple defined in 16 places.'>name</a>(), <a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>, <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>);
<a name='L94'>  94                 <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>=<a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>;
<a name='L95'>  95                 <b>return</b>;
<a name='L96'>  96         <font color='red'>}</font>
<a name='L97'>  97         <a href='../Y/1502.html' title='Multiple used in 179 places.'>assert</a>(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>);           <i><font color='green'>// need to have someting here</font></i>
<a name='L98'>  98         <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"Test %s:  Starting pcap filter \"%s\" on dev %s for channel %d\n",
<a name='L99'>  99                         <a href='../Y/4481.html' title='Multiple used in 122 places.'>mod</a>-&gt;<a href='../D/8420.html' title='Multiple defined in 16 places.'>name</a>(), <a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>, <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>, <a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>);
<a name='L100'> 100         <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>[0]=0;
<a name='L101'> 101         <b>if</b>(<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a> != <a href='../S/55.html#L13' title='Defined at 13 in cbench/oflops/test_module.h.'>OFLOPS_CONTROL</a>) <font color='red'>{</font>
<a name='L102'> 102         <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a> = <a href='../Y/5679.html' title='Multiple used in 2 places.'>pcap_open_live</a>(
<a name='L103'> 103                                         <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>,
<a name='L104'> 104                                         <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/6852.html' title='Multiple used in 12 places.'>snaplen</a>,
<a name='L105'> 105                                         1,      <i><font color='green'>// promisc</font></i>
<a name='L106'> 106                                         0,      <i><font color='green'>// read timeout (ms)</font></i>
<a name='L107'> 107                                         <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>  <i><font color='green'>// for error messages</font></i>
<a name='L108'> 108                         );
<a name='L109'> 109         <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L110'> 110           <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a> = <a href='../Y/5679.html' title='Multiple used in 2 places.'>pcap_open_live</a>(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>,65000,1,0,<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L111'> 111           <b>if</b>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/2601.html' title='Multiple used in 7 places.'>dump_controller</a>) <font color='red'>{</font> 
<a name='L112'> 112             <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../S/252.html#L203' title='Defined at 203 in cbench/openflow/tests/test-stp.c.'>dump</a> = pcap_dump_open(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>, "controller.pcap");
<a name='L113'> 113             <a href='../Y/5906.html' title='Multiple used in 387 places.'>printf</a>("XXXXXXXXXXXXXXXX Dumping controller channel to to file\n");
<a name='L114'> 114           <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L115'> 115             <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../S/252.html#L203' title='Defined at 203 in cbench/openflow/tests/test-stp.c.'>dump</a> = <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>;
<a name='L116'> 116             <a href='../Y/5906.html' title='Multiple used in 387 places.'>printf</a>("XXXXXXXXXXXXXX not dumping controller\n");
<a name='L117'> 117           <font color='red'>}</font>
<a name='L118'> 118         <font color='red'>}</font>
<a name='L119'> 119         <b>if</b>(!<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>)
<a name='L120'> 120         <font color='red'>{</font>
<a name='L121'> 121                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>( <a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "pcap_open_live failed: %s\n",<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L122'> 122                 <a href='../Y/2943.html' title='Multiple used in 74 places.'>exit</a>(1);
<a name='L123'> 123         <font color='red'>}</font>
<a name='L124'> 124         <b>if</b>(<a href='../Y/7098.html' title='Multiple used in 203 places.'>strlen</a>(<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>)&gt;0)
<a name='L125'> 125                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>( <a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "Non-fatal pcap warning: %s\n", <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L126'> 126         <b>if</b>((pcap_lookupnet(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/2359.html' title='Multiple used in 435 places.'>dev</a>,&amp;<a href='../Y/4697.html' title='Multiple used in 6 places.'>net</a>,&amp;<a href='../Y/4338.html' title='Multiple used in 220 places.'>mask</a>,<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>) == -1) &amp;&amp;
<a name='L127'> 127                         (<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a> == <a href='../S/55.html#L13' title='Defined at 13 in cbench/oflops/test_module.h.'>OFLOPS_CONTROL</a>))         <i><font color='green'>// only control has an IP</font></i>
<a name='L128'> 128         <font color='red'>{</font>
<a name='L129'> 129                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"WARN: pcap_lookupnet: %s; ",<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L130'> 130                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"filter rules might fail\n");
<a name='L131'> 131         <font color='red'>}</font>
<a name='L132'> 132 
<a name='L133'> 133         <a href='../Y/1748.html' title='Multiple used in 31 places.'>bzero</a>(&amp;<a href='../Y/3075.html' title='Multiple used in 66 places.'>filter</a>, <b>sizeof</b>(<a href='../Y/3075.html' title='Multiple used in 66 places.'>filter</a>));
<a name='L134'> 134         <b>if</b>(pcap_compile(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>, &amp;<a href='../Y/3075.html' title='Multiple used in 66 places.'>filter</a>, <a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>, 1, <a href='../Y/4697.html' title='Multiple used in 6 places.'>net</a>))
<a name='L135'> 135         <font color='red'>{</font>
<a name='L136'> 136                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>( <a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "pcap_compile: %s\n", <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L137'> 137                 <a href='../Y/2943.html' title='Multiple used in 74 places.'>exit</a>(1);
<a name='L138'> 138         <font color='red'>}</font>
<a name='L139'> 139         <b>if</b>(<a href='../Y/7098.html' title='Multiple used in 203 places.'>strlen</a>(<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>)&gt;0)
<a name='L140'> 140                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>( <a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "Non-fatal pcap_setfilter: %s\n", <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L141'> 141 
<a name='L142'> 142         <b>if</b>(pcap_setfilter(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>,&amp;<a href='../Y/3075.html' title='Multiple used in 66 places.'>filter</a> ) == -1)
<a name='L143'> 143         <font color='red'>{</font>
<a name='L144'> 144                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"pcap_setfilter: %s\n",<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L145'> 145                 <a href='../Y/2943.html' title='Multiple used in 74 places.'>exit</a>(1);
<a name='L146'> 146         <font color='red'>}</font>
<a name='L147'> 147         <b>if</b>(pcap_setnonblock(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>, 1, <a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>))
<a name='L148'> 148                 <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"setup_channel: pcap_setnonblock(): %s\n",<a href='../Y/2757.html' title='Multiple used in 17 places.'>errbuf</a>);
<a name='L149'> 149         <a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5673.html' title='Multiple used in 5 places.'>pcap_fd</a> = pcap_get_selectable_fd(<a href='../Y/1845.html' title='Multiple used in 39 places.'>ch_info</a>-&gt;<a href='../Y/5676.html' title='Multiple used in 16 places.'>pcap_handle</a>);
<a name='L150'> 150 
<a name='L151'> 151 <font color='red'>}</font>
<a name='L152'> 152 
<a name='L153'> 153 <b>int</b>
<a name='L154'> 154 <a href='../R/3550.html' title='Multiple refered from 3 places.'>my_read_objid</a>(<b>char</b> *<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>, <a href='../Y/5419.html' title='Multiple used in 48 places.'>oid</a> *<a href='../Y/5545.html' title='Multiple used in 19 places.'>out_oid</a>, <a href='../Y/6800.html' title='Multiple used in 615 places.'>size_t</a> *<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>) <font color='red'>{</font>
<a name='L155'> 155   <b>int</b> <a href='../Y/5421.html' title='Multiple used in 8 places.'>oid_len</a> = *<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>, <a href='../Y/5568.html' title='Multiple used in 1140 places.'>p</a> = 0, <a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a> = 0, <a href='../Y/4119.html' title='Multiple used in 983 places.'>len</a> = <a href='../Y/7098.html' title='Multiple used in 203 places.'>strlen</a>(<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>);
<a name='L156'> 156   *(<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>) = 0;
<a name='L157'> 157   <b>while</b>(1) <font color='red'>{</font>
<a name='L158'> 158     <a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a> = <a href='../Y/5568.html' title='Multiple used in 1140 places.'>p</a>;
<a name='L159'> 159     <b>while</b>((<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>[<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>] != '.') &amp;&amp;
<a name='L160'> 160           (<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>[<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>] != '\0')) <font color='red'>{</font>
<a name='L161'> 161       <a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>++;
<a name='L162'> 162     <font color='red'>}</font>
<a name='L163'> 163     <a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>[<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>] = '\0';
<a name='L164'> 164     <a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>++;
<a name='L165'> 165     <a href='../Y/5545.html' title='Multiple used in 19 places.'>out_oid</a>[*(<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>)] = (<a href='../Y/5419.html' title='Multiple used in 48 places.'>oid</a>)<a href='../Y/7111.html' title='Multiple used in 96 places.'>strtol</a>(<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>+<a href='../Y/5568.html' title='Multiple used in 1140 places.'>p</a>, <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>, 10);
<a name='L166'> 166     <b>if</b>(<a href='../Y/5421.html' title='Multiple used in 8 places.'>oid_len</a> == *<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>) <b>return</b> 0;
<a name='L167'> 167     *(<a href='../Y/5546.html' title='Multiple used in 6 places.'>out_oid_len</a>)+=1;
<a name='L168'> 168     <a href='../Y/5568.html' title='Multiple used in 1140 places.'>p</a>=<a href='../Y/7400.html' title='Multiple used in 360 places.'>tmp</a>;
<a name='L169'> 169     <b>if</b>(<a href='../Y/5568.html' title='Multiple used in 1140 places.'>p</a> &gt;= <a href='../Y/4119.html' title='Multiple used in 983 places.'>len</a>)
<a name='L170'> 170       <b>break</b>;
<a name='L171'> 171   <font color='red'>}</font>
<a name='L172'> 172   <b>return</b> 1;
<a name='L173'> 173 <font color='red'>}</font>
<a name='L174'> 174 
<a name='L175'> 175 <i><font color='green'>/****************************************************</font></i>
<a name='L176'> 176 <i><font color='green'> * query module if they want pcap and set it up for them if yes</font></i>
<a name='L177'> 177 <i><font color='green'> * also create a raw_socket bound to each device if we have the</font></i>
<a name='L178'> 178 <i><font color='green'> * device set</font></i>
<a name='L179'> 179 <i><font color='green'> */</font></i>
<a name='L180'> 180 <b>void</b> <a href='../R/4442.html' title='Multiple refered from 2 places.'>setup_channel_snmp</a>(<a href='../Y/5077.html' title='Multiple used in 258 places.'>oflops_context</a> *<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>, <a href='../Y/5076.html' title='Multiple used in 49 places.'>oflops_channel_name</a> <a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>, <b>char</b> *<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>, <b>char</b> *<a href='../Y/5545.html' title='Multiple used in 19 places.'>out_oid</a>) <font color='red'>{</font>
<a name='L181'> 181   <i><font color='green'>//  printf("%s %d \n", oid, ctx-&gt;channels[ch].anOID_len);</font></i>
<a name='L182'> 182   <b>if</b>(<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>)  
<a name='L183'> 183     <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/3766.html' title='Multiple used in 38 places.'>inOID_len</a> = 0;
<a name='L184'> 184   <b>else</b> <font color='red'>{</font>
<a name='L185'> 185     <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/3766.html' title='Multiple used in 38 places.'>inOID_len</a> = <a href='../Y/538.html' title='Multiple used in 8 places.'>MAX_OID_LEN</a>;
<a name='L186'> 186     <a href='../S/60.html#L154' title='Defined at 154 in cbench/oflops/channel_info.c.'>my_read_objid</a>(<a href='../Y/3784.html' title='Multiple used in 20 places.'>in_oid</a>, <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/3765.html' title='Multiple used in 24 places.'>inOID</a>, &amp;<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/3766.html' title='Multiple used in 38 places.'>inOID_len</a>);    
<a name='L187'> 187     <i><font color='green'>/* if(read_objid(in_oid, ctx-&gt;channels[ch].inOID, &amp;ctx-&gt;channels[ch].inOID_len) == 0) { */</font></i>
<a name='L188'> 188     <i><font color='green'>/*   printf("inOID: %s(%d)\n", in_oid,  ctx-&gt;channels[OFLOPS_CONTROL].inOID_len); */</font></i>
<a name='L189'> 189     <i><font color='green'>/*   snmp_perror("ack"); */</font></i>
<a name='L190'> 190     <i><font color='green'>/*   perror_and_exit("read_objid failed", 1);   */</font></i>
<a name='L191'> 191     <i><font color='green'>/* } */</font></i>
<a name='L192'> 192   <font color='red'>}</font>
<a name='L193'> 193   
<a name='L194'> 194   <b>if</b>(<a href='../Y/5545.html' title='Multiple used in 19 places.'>out_oid</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>)  
<a name='L195'> 195     <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/5533.html' title='Multiple used in 61 places.'>outOID_len</a> = 0;
<a name='L196'> 196   <b>else</b> <font color='red'>{</font>
<a name='L197'> 197     <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/5533.html' title='Multiple used in 61 places.'>outOID_len</a> = <a href='../Y/538.html' title='Multiple used in 8 places.'>MAX_OID_LEN</a>;
<a name='L198'> 198     <a href='../S/60.html#L154' title='Defined at 154 in cbench/oflops/channel_info.c.'>my_read_objid</a>(<a href='../Y/5545.html' title='Multiple used in 19 places.'>out_oid</a>, <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/5532.html' title='Multiple used in 47 places.'>outOID</a>, &amp;<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>-&gt;<a href='../Y/1859.html' title='Multiple used in 259 places.'>channels</a>[<a href='../Y/1844.html' title='Multiple used in 305 places.'>ch</a>].<a href='../Y/5533.html' title='Multiple used in 61 places.'>outOID_len</a>);
<a name='L199'> 199     <i><font color='green'>/* if(read_objid(out_oid, ctx-&gt;channels[ch].outOID, &amp;ctx-&gt;channels[ch].outOID_len) == 0) */</font></i>
<a name='L200'> 200     <i><font color='green'>/*   perror_and_exit("read_objid failed", 1);     */</font></i>
<a name='L201'> 201   <font color='red'>}</font>
<a name='L202'> 202 <font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L20'>[^]</a><a href='#L180'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
