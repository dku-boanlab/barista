<html>
<head>
<title>cbench/oflops/example_modules/snmp_cpu/snmpcpu.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/1100.html'>cbench</a>/<a href='../files/1101.html'>oflops</a>/<a href='../files/1103.html'>example_modules</a>/<a href='../files/1120.html'>snmp_cpu</a>/snmpcpu.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L22'>[^]</a><a href='#L91'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L22' title='Defined at 22.'>name</a>
<li><a href='#L30' title='Defined at 30.'>start</a>
<li><a href='#L65' title='Defined at 65.'>handle_timer_event</a>
<li><a href='#L91' title='Defined at 91.'>handle_snmp_event</a>
</ol>
<hr>
<pre>
<a name='L1'>   1 <font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L2'>   2 <font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L3'>   3 <font color='darkred'>#include</font> &lt;string.h&gt;
<a name='L4'>   4 
<a name='L5'>   5 <font color='darkred'>#include</font> &lt;<a href='55.html'>test_module.h</a>&gt;
<a name='L6'>   6 
<a name='L7'>   7 <i><font color='green'>/** String for scheduling events</font></i>
<a name='L8'>   8 <i><font color='green'> */</font></i>
<a name='L9'>   9 <font color='darkred'>#define</font> <a href='../R/159.html' title='Multiple refered from 32 places.'>BYESTR</a> "bye bye"
<a name='L10'>  10 <font color='darkred'>#define</font> <a href='../R/1773.html' title='Multiple refered from 6 places.'>WRITEPACKET</a> "write packet"
<a name='L11'>  11 
<a name='L12'>  12 <i><font color='green'>/** @ingroup modules</font></i>
<a name='L13'>  13 <i><font color='green'> * SNMP CPU module.</font></i>
<a name='L14'>  14 <i><font color='green'> * The module sends SNMP requests to probe CPU load of switches.</font></i>
<a name='L15'>  15 <i><font color='green'> *</font></i>
<a name='L16'>  16 <i><font color='green'> * Copyright (C) Stanford University, 2009</font></i>
<a name='L17'>  17 <i><font color='green'> * @author ykk</font></i>
<a name='L18'>  18 <i><font color='green'> * @date December, 2009</font></i>
<a name='L19'>  19 <i><font color='green'> * </font></i>
<a name='L20'>  20 <i><font color='green'> * @return name of module</font></i>
<a name='L21'>  21 <i><font color='green'> */</font></i>
<a name='L22'>  22 <b>char</b> * <a href='../R/3559.html' title='Multiple refered from 876 places.'>name</a>()
<a name='L23'>  23 <font color='red'>{</font>
<a name='L24'>  24         <b>return</b> "Snmp_cpu_module";
<a name='L25'>  25 <font color='red'>}</font>
<a name='L26'>  26 
<a name='L27'>  27 <i><font color='green'>/** Initialization</font></i>
<a name='L28'>  28 <i><font color='green'> * @param ctx pointer to opaque context</font></i>
<a name='L29'>  29 <i><font color='green'> */</font></i>
<a name='L30'>  30 <b>int</b> <a href='../R/4512.html' title='Multiple refered from 167 places.'>start</a>(<b>struct</b> <a href='../Y/5077.html' title='Multiple used in 258 places.'>oflops_context</a> * <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>)
<a name='L31'>  31 <font color='red'>{</font>
<a name='L32'>  32   <b>struct</b> <a href='../Y/7388.html' title='Multiple used in 197 places.'>timeval</a> <a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>;
<a name='L33'>  33   <b>struct</b> <a href='../D/8801.html' title='Multiple defined in 3 places.'>ofp_header</a> <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>;
<a name='L34'>  34   <a href='../Y/3429.html' title='Multiple used in 133 places.'>gettimeofday</a>(&amp;<a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>, <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>);
<a name='L35'>  35 
<a name='L36'>  36   <i><font color='green'>//Schedule start</font></i>
<a name='L37'>  37   <a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>.<a href='../Y/7510.html' title='Multiple used in 122 places.'>tv_sec</a> +=5;       
<a name='L38'>  38   <a href='../S/121.html#L94' title='Defined at 94 in cbench/oflops/test_module.c.'>oflops_schedule_timer_event</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,&amp;<a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>, <a href='../D/5992.html' title='Multiple defined in 7 places.'>WRITEPACKET</a>);
<a name='L39'>  39   
<a name='L40'>  40   <i><font color='green'>//Schedule end</font></i>
<a name='L41'>  41   <a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>.<a href='../Y/7510.html' title='Multiple used in 122 places.'>tv_sec</a> += 5;      <i><font color='green'>// 0.5 min on the future, stop this module</font></i>
<a name='L42'>  42   <a href='../S/121.html#L94' title='Defined at 94 in cbench/oflops/test_module.c.'>oflops_schedule_timer_event</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,&amp;<a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>, <a href='../D/523.html' title='Multiple defined in 16 places.'>BYESTR</a>);
<a name='L43'>  43 
<a name='L44'>  44   <i><font color='green'>// send a friendly hello</font></i>
<a name='L45'>  45   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/4125.html' title='Multiple used in 540 places.'>length</a> = <a href='../Y/3678.html' title='Multiple used in 586 places.'>htons</a>(<b>sizeof</b>(<b>struct</b> <a href='../D/8801.html' title='Multiple defined in 3 places.'>ofp_header</a>));
<a name='L46'>  46   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7997.html' title='Multiple used in 182 places.'>xid</a> = 0;
<a name='L47'>  47   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7553.html' title='Multiple used in 958 places.'>type</a> = <a href='../D/3675.html' title='Multiple defined in 3 places.'>OFPT_HELLO</a>;
<a name='L48'>  48   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7770.html' title='Multiple used in 173 places.'>version</a> = <a href='../Y/621.html' title='Multiple used in 78 places.'>OFP_VERSION</a>;
<a name='L49'>  49   <a href='../S/121.html#L119' title='Defined at 119 in cbench/oflops/test_module.c.'>oflops_send_of_mesg</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,&amp;<a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>);
<a name='L50'>  50 
<a name='L51'>  51   <i><font color='green'>// send a features request, to stave off timeout (ignore response)</font></i>
<a name='L52'>  52   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/4125.html' title='Multiple used in 540 places.'>length</a> = <a href='../Y/3678.html' title='Multiple used in 586 places.'>htons</a>(<b>sizeof</b>(<b>struct</b> <a href='../D/8801.html' title='Multiple defined in 3 places.'>ofp_header</a>));
<a name='L53'>  53   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7997.html' title='Multiple used in 182 places.'>xid</a> = 0;
<a name='L54'>  54   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7553.html' title='Multiple used in 958 places.'>type</a> = <a href='../D/3666.html' title='Multiple defined in 3 places.'>OFPT_FEATURES_REQUEST</a>;
<a name='L55'>  55   <a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>.<a href='../Y/7770.html' title='Multiple used in 173 places.'>version</a> = <a href='../Y/621.html' title='Multiple used in 78 places.'>OFP_VERSION</a>;
<a name='L56'>  56   <a href='../S/121.html#L119' title='Defined at 119 in cbench/oflops/test_module.c.'>oflops_send_of_mesg</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,&amp;<a href='../Y/5378.html' title='Multiple used in 178 places.'>ofph</a>);
<a name='L57'>  57 
<a name='L58'>  58   <b>return</b> 0;
<a name='L59'>  59 <font color='red'>}</font>
<a name='L60'>  60 
<a name='L61'>  61 <i><font color='green'>/** Handle timer event</font></i>
<a name='L62'>  62 <i><font color='green'> * @param ctx pointer to opaque context</font></i>
<a name='L63'>  63 <i><font color='green'> * @param te pointer to timer event</font></i>
<a name='L64'>  64 <i><font color='green'> */</font></i>
<a name='L65'>  65 <b>int</b> <a href='../R/3193.html' title='Multiple refered from 3 places.'>handle_timer_event</a>(<b>struct</b> <a href='../Y/5077.html' title='Multiple used in 258 places.'>oflops_context</a> * <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>, <b>struct</b> <a href='../Y/7377.html' title='Multiple used in 19 places.'>timer_event</a> *<a href='../Y/7295.html' title='Multiple used in 60 places.'>te</a>)
<a name='L66'>  66 <font color='red'>{</font>
<a name='L67'>  67   <b>char</b> * <a href='../Y/7069.html' title='Multiple used in 188 places.'>str</a>;
<a name='L68'>  68   <b>struct</b> <a href='../Y/7388.html' title='Multiple used in 197 places.'>timeval</a> <a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>;
<a name='L69'>  69 
<a name='L70'>  70   <a href='../Y/7069.html' title='Multiple used in 188 places.'>str</a> = (<b>char</b> *) <a href='../Y/7295.html' title='Multiple used in 60 places.'>te</a>-&gt;<a href='../Y/1454.html' title='Multiple used in 77 places.'>arg</a>;
<a name='L71'>  71   <a href='../Y/5419.html' title='Multiple used in 48 places.'>oid</a> <a href='../Y/6198.html' title='Multiple used in 29 places.'>query</a>[] = <font color='red'>{</font> 1, 3, 6, 1, 4, 1, 21839, 2, 2, 11, 2, 1, 2, 1, 11, 1 <font color='red'>}</font>;
<a name='L72'>  72   <a href='../Y/3429.html' title='Multiple used in 133 places.'>gettimeofday</a>(&amp;<a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>, <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>);
<a name='L73'>  73 
<a name='L74'>  74   <b>if</b>(!<a href='../Y/7082.html' title='Multiple used in 371 places.'>strcmp</a>(<a href='../Y/7069.html' title='Multiple used in 188 places.'>str</a>,<a href='../D/5992.html' title='Multiple defined in 7 places.'>WRITEPACKET</a>))
<a name='L75'>  75   <font color='red'>{</font>
<a name='L76'>  76     <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "Send SNMP request\n");
<a name='L77'>  77     <a href='../S/121.html#L178' title='Defined at 178 in cbench/oflops/test_module.c.'>oflops_snmp_get</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>, <a href='../Y/6198.html' title='Multiple used in 29 places.'>query</a>,<b>sizeof</b>(<a href='../Y/6198.html' title='Multiple used in 29 places.'>query</a>)/<b>sizeof</b>(<a href='../Y/5419.html' title='Multiple used in 48 places.'>oid</a>));
<a name='L78'>  78     <a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>.<a href='../Y/7510.html' title='Multiple used in 122 places.'>tv_sec</a> +=1;     
<a name='L79'>  79     <a href='../S/121.html#L94' title='Defined at 94 in cbench/oflops/test_module.c.'>oflops_schedule_timer_event</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,&amp;<a href='../Y/4938.html' title='Multiple used in 566 places.'>now</a>, <a href='../D/5992.html' title='Multiple defined in 7 places.'>WRITEPACKET</a>);
<a name='L80'>  80   <font color='red'>}</font>
<a name='L81'>  81   <b>else</b> <b>if</b>(!<a href='../Y/7082.html' title='Multiple used in 371 places.'>strcmp</a>(<a href='../Y/7069.html' title='Multiple used in 188 places.'>str</a>,<a href='../D/523.html' title='Multiple defined in 16 places.'>BYESTR</a>))
<a name='L82'>  82   <font color='red'>{</font>
<a name='L83'>  83     <i><font color='green'>//End experiment</font></i>
<a name='L84'>  84     <a href='../S/121.html#L27' title='Defined at 27 in cbench/oflops/test_module.c.'>oflops_end_test</a>(<a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>,1);
<a name='L85'>  85   <font color='red'>}</font>
<a name='L86'>  86   <b>else</b>
<a name='L87'>  87     <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>, "Unknown timer event: %s", <a href='../Y/7069.html' title='Multiple used in 188 places.'>str</a>);
<a name='L88'>  88   <b>return</b> 0;
<a name='L89'>  89 <font color='red'>}</font>
<a name='L90'>  90 
<a name='L91'>  91 <b>int</b> <a href='../R/3192.html' title='Multiple refered from 3 places.'>handle_snmp_event</a>(<b>struct</b> <a href='../Y/5077.html' title='Multiple used in 258 places.'>oflops_context</a> * <a href='../Y/2205.html' title='Multiple used in 1149 places.'>ctx</a>, <b>struct</b> <a href='../Y/6876.html' title='Multiple used in 17 places.'>snmp_event</a> * <a href='../Y/6614.html' title='Multiple used in 47 places.'>se</a>)
<a name='L92'>  92 <font color='red'>{</font>
<a name='L93'>  93   <b>char</b> <a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>[1024];
<a name='L94'>  94   snprint_variable(<a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>, <b>sizeof</b>(<a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>), <a href='../Y/6614.html' title='Multiple used in 47 places.'>se</a>-&gt;<a href='../Y/6383.html' title='Multiple used in 144 places.'>reply</a>-&gt;<a href='../D/8420.html' title='Multiple defined in 16 places.'>name</a>, <a href='../Y/6614.html' title='Multiple used in 47 places.'>se</a>-&gt;<a href='../Y/6383.html' title='Multiple used in 144 places.'>reply</a>-&gt;<a href='../Y/4637.html' title='Multiple used in 50 places.'>name_length</a>, <a href='../Y/6614.html' title='Multiple used in 47 places.'>se</a>-&gt;<a href='../Y/6383.html' title='Multiple used in 144 places.'>reply</a>);
<a name='L95'>  95   <a href='../Y/3207.html' title='Multiple used in 289 places.'>fprintf</a>(<a href='../Y/7049.html' title='Multiple used in 246 places.'>stderr</a>,"SNMP response: %s\n",<a href='../Y/1693.html' title='Multiple used in 469 places.'>buf</a>);
<a name='L96'>  96   <b>return</b> 0;
<a name='L97'>  97 <font color='red'>}</font>
<a name='L98'>  98 
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L22'>[^]</a><a href='#L91'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
