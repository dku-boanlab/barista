<html>
<head>
<title>cbench/openflow/hw-lib/skeleton/txrx.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/1100.html'>cbench</a>/<a href='../files/1124.html'>openflow</a>/<a href='../files/1135.html'>hw-lib</a>/<a href='../files/1137.html'>skeleton</a>/txrx.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L15'>[^]</a><a href='#L112'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L15' title='Defined at 15.'>tx_pkt_callback</a>
<li><a href='#L41' title='Defined at 41.'>of_hw_packet_send</a>
<li><a href='#L50' title='Defined at 50.'>of_hw_rx</a>
<li><a href='#L112' title='Defined at 112.'>of_hw_packet_receive_register</a>
</ol>
<hr>
<pre>
<a name='L1'>   1 <i><font color='green'>/*</font></i>
<a name='L2'>   2 <i><font color='green'> * Transmit and receive related functions for hardware platforms</font></i>
<a name='L3'>   3 <i><font color='green'> */</font></i>
<a name='L4'>   4 
<a name='L5'>   5 <font color='darkred'>#include</font> &lt;<a href='183.html'>of_hw_api.h</a>&gt;
<a name='L6'>   6 <font color='darkred'>#include</font> "<a href='221.html'>os.h</a>"
<a name='L7'>   7 <font color='darkred'>#include</font> "<a href='222.html'>hw_drv.h</a>"
<a name='L8'>   8 <font color='darkred'>#include</font> "<a href='217.html'>txrx.h</a>"
<a name='L9'>   9 <font color='darkred'>#include</font> "<a href='213.html'>port.h</a>"
<a name='L10'>  10 <font color='darkred'>#include</font> "<a href='../I/149.html'>debug.h</a>"
<a name='L11'>  11 <font color='darkred'>#include</font> "<a href='220.html'>of_hw_platform.h</a>"
<a name='L12'>  12 
<a name='L13'>  13 <b>static</b> <b>int</b> <a href='../Y/5744.html' title='Multiple used in 39 places.'>pkt_count</a>, failures, prev_success, <a href='../Y/3235.html' title='Multiple used in 2 places.'>free_count</a>, error_free;
<a name='L14'>  14 <b>static</b> <b>void</b>
<a name='L15'>  15 tx_pkt_callback(...)
<a name='L16'>  16 <font color='red'>{</font>
<a name='L17'>  17     <a href='../S/183.html#L81' title='Defined at 81 in cbench/openflow/include/openflow/of_hw_api.h.'>of_packet_t</a> *<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a> = <a href='../Y/2133.html' title='Multiple used in 81 places.'>cookie</a>;
<a name='L18'>  18 
<a name='L19'>  19     <i><font color='green'>/* os_pkt_free(of_pkt-&gt;os_pkt); */</font></i>
<a name='L20'>  20     <a href='../D/1836.html' title='Multiple defined in 7 places.'>FREE</a>(<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>);
<a name='L21'>  21     <i><font color='green'>/* ... */</font></i>
<a name='L22'>  22     ++<a href='../Y/3235.html' title='Multiple used in 2 places.'>free_count</a>;
<a name='L23'>  23 <font color='red'>}</font>
<a name='L24'>  24 
<a name='L25'>  25 <i><font color='green'>/*</font></i>
<a name='L26'>  26 <i><font color='green'> * tx_packet_send(table, of_port, pkt, flags)</font></i>
<a name='L27'>  27 <i><font color='green'> *</font></i>
<a name='L28'>  28 <i><font color='green'> * Send packet to an openflow port.</font></i>
<a name='L29'>  29 <i><font color='green'> *</font></i>
<a name='L30'>  30 <i><font color='green'> * Proposed flags:</font></i>
<a name='L31'>  31 <i><font color='green'> *     APPLY_FLOW_TABLE:  If set, and if the hardware supports</font></i>
<a name='L32'>  32 <i><font color='green'> *     it, send the packet through the flow table with the source</font></i>
<a name='L33'>  33 <i><font color='green'> *     port being the local CPU port.  (Would be nice to have</font></i>
<a name='L34'>  34 <i><font color='green'> *     a flexible source port indicated; could hide in flags...)</font></i>
<a name='L35'>  35 <i><font color='green'> *</font></i>
<a name='L36'>  36 <i><font color='green'> * Assumes buffer in pkt struct can be used for sending data</font></i>
<a name='L37'>  37 <i><font color='green'> *</font></i>
<a name='L38'>  38 <i><font color='green'> *</font></i>
<a name='L39'>  39 <i><font color='green'> */</font></i>
<a name='L40'>  40 <b>int</b>
<a name='L41'>  41 <a href='../R/3785.html' title='Multiple refered from 2 places.'>of_hw_packet_send</a>(<a href='../S/183.html#L69' title='Defined at 69 in cbench/openflow/include/openflow/of_hw_api.h.'>of_hw_driver_t</a> *<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>, <b>int</b> <a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a>, <a href='../S/183.html#L81' title='Defined at 81 in cbench/openflow/include/openflow/of_hw_api.h.'>of_packet_t</a> *<a href='../Y/5742.html' title='Multiple used in 103 places.'>pkt</a>,
<a name='L42'>  42                   <a href='../Y/7621.html' title='Multiple used in 1429 places.'>uint32_t</a> <a href='../Y/3119.html' title='Multiple used in 292 places.'>flags</a>)
<a name='L43'>  43 <font color='red'>{</font>
<a name='L44'>  44     <i><font color='green'>/* FIXME:  Code to prepare and send pkt */</font></i>
<a name='L45'>  45     <b>return</b> 0;
<a name='L46'>  46 <font color='red'>}</font>
<a name='L47'>  47 
<a name='L48'>  48 <i><font color='green'>/* Callback function registered with HW */</font></i>
<a name='L49'>  49 <b>static</b> <b>int</b>
<a name='L50'>  50 of_hw_rx(...)
<a name='L51'>  51 <font color='red'>{</font>
<a name='L52'>  52     <i><font color='green'>/* Sample RX handler */</font></i>
<a name='L53'>  53     <b>int</b> <a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a>;
<a name='L54'>  54     <a href='../S/222.html#L87' title='Defined at 87 in cbench/openflow/hw-lib/skeleton/hw_drv.h.'>of_hw_driver_int_t</a> *<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>;
<a name='L55'>  55     <a href='../S/183.html#L81' title='Defined at 81 in cbench/openflow/include/openflow/of_hw_api.h.'>of_packet_t</a> *<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>;
<a name='L56'>  56     <b>int</b> <a href='../Y/5750.html' title='Multiple used in 7 places.'>pkt_len</a>;
<a name='L57'>  57 
<a name='L58'>  58     <i><font color='green'>/* map receive port to of_port */</font></i>
<a name='L59'>  59     <i><font color='green'>/* map received packet to of_pkt */</font></i>
<a name='L60'>  60     <i><font color='green'>/* Call callback */</font></i>
<a name='L61'>  61 
<a name='L62'>  62     <a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a> = <a href='../S/214.html#L22' title='Defined at 22 in cbench/openflow/hw-lib/skeleton/sample_plat.h.'>of_hw_port_to_of_port</a>(receive_port);
<a name='L63'>  63     <b>if</b> (<a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a> &lt; 0) <font color='red'>{</font>
<a name='L64'>  64         <b>return</b> <a href='../Y/3692.html' title='Multiple used in 4 places.'>hw_not_handled</a>;
<a name='L65'>  65     <font color='red'>}</font>
<a name='L66'>  66 
<a name='L67'>  67     <i><font color='green'>/* LOCK */</font></i>
<a name='L68'>  68     <a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a> = (<a href='../S/222.html#L87' title='Defined at 87 in cbench/openflow/hw-lib/skeleton/hw_drv.h.'>of_hw_driver_int_t</a> *)(<a href='../Y/5051.html' title='Multiple used in 18 places.'>of_hw_ports</a>[<a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a>].<a href='../Y/5563.html' title='Multiple used in 21 places.'>owner</a>);
<a name='L69'>  69     <b>if</b> ((<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>) || (<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>-&gt;<a href='../Y/6523.html' title='Multiple used in 4 places.'>rx_handler</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>)) <font color='red'>{</font>
<a name='L70'>  70         <i><font color='green'>/* UNLOCK */</font></i>
<a name='L71'>  71         <b>return</b> <a href='../Y/3692.html' title='Multiple used in 4 places.'>hw_not_handled</a>;
<a name='L72'>  72     <font color='red'>}</font>
<a name='L73'>  73 
<a name='L74'>  74     <a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a> = <a href='../S/221.html#L11' title='Defined at 11 in cbench/openflow/hw-lib/skeleton/os.h.'>ALLOC</a>(<b>sizeof</b>(<a href='../S/183.html#L81' title='Defined at 81 in cbench/openflow/include/openflow/of_hw_api.h.'>of_packet_t</a>));
<a name='L75'>  75     <b>if</b> (<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>) <font color='red'>{</font>
<a name='L76'>  76         ++<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>-&gt;<a href='../Y/6527.html' title='Multiple used in 2 places.'>rx_pkt_alloc_failures</a>;
<a name='L77'>  77         <i><font color='green'>/* UNLOCK */</font></i>
<a name='L78'>  78         <b>return</b> <a href='../Y/3692.html' title='Multiple used in 4 places.'>hw_not_handled</a>;
<a name='L79'>  79     <font color='red'>}</font>
<a name='L80'>  80     <a href='../Y/5750.html' title='Multiple used in 7 places.'>pkt_len</a> = <a href='../Y/5742.html' title='Multiple used in 103 places.'>pkt</a>-&gt;<a href='../Y/7431.html' title='Multiple used in 9 places.'>tot_len</a>;
<a name='L81'>  81 
<a name='L82'>  82     <i><font color='green'>/* FIXME:  FOR NOW, COPY DATA INTO NEW BUFFER;  */</font></i>
<a name='L83'>  83     <a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>-&gt;<a href='../Y/2247.html' title='Multiple used in 1185 places.'>data</a> = <a href='../S/221.html#L11' title='Defined at 11 in cbench/openflow/hw-lib/skeleton/os.h.'>ALLOC</a>(<a href='../Y/5750.html' title='Multiple used in 7 places.'>pkt_len</a>);
<a name='L84'>  84     <b>if</b> (<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>-&gt;<a href='../Y/2247.html' title='Multiple used in 1185 places.'>data</a> == <a href='../Y/603.html' title='Multiple used in 2170 places.'>NULL</a>) <font color='red'>{</font>
<a name='L85'>  85         <a href='../D/1836.html' title='Multiple defined in 7 places.'>FREE</a>(<a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>);
<a name='L86'>  86         <i><font color='green'>/* UNLOCK */</font></i>
<a name='L87'>  87         <b>return</b> <a href='../Y/3692.html' title='Multiple used in 4 places.'>hw_not_handled</a>;
<a name='L88'>  88     <font color='red'>}</font>
<a name='L89'>  89 
<a name='L90'>  90     <i><font color='green'>/* Handle VLAN tagging if needed */</font></i>
<a name='L91'>  91     <i><font color='green'>/* Coy pkt data appropriately */</font></i>
<a name='L92'>  92 
<a name='L93'>  93     <i><font color='green'>/* FIXME:  Determine reason (dflt rule or directed) */</font></i>
<a name='L94'>  94     <i><font color='green'>/* FIXME:  Return code interpretation? */</font></i>
<a name='L95'>  95     <i><font color='green'>/* OFPR_NO_MATCH,      No matching flow. */</font></i>
<a name='L96'>  96     <i><font color='green'>/* OFPR_ACTION         Action explicitly output to controller. */</font></i>
<a name='L97'>  97     <a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>-&gt;<a href='../Y/6523.html' title='Multiple used in 4 places.'>rx_handler</a>(<a href='../Y/5057.html' title='Multiple used in 162 places.'>of_port</a>, <a href='../Y/5056.html' title='Multiple used in 9 places.'>of_pkt</a>, 0, <a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>-&gt;<a href='../Y/6516.html' title='Multiple used in 3 places.'>rx_cookie</a>);
<a name='L98'>  98     <i><font color='green'>/* UNLOCK */</font></i>
<a name='L99'>  99 
<a name='L100'> 100     <b>return</b> hw_handled;
<a name='L101'> 101 <font color='red'>}</font>
<a name='L102'> 102 
<a name='L103'> 103 <b>static</b> <b>int</b> <a href='../Y/6543.html' title='Multiple used in 3 places.'>rx_registered</a> = 0;
<a name='L104'> 104 
<a name='L105'> 105 <i><font color='green'>/*</font></i>
<a name='L106'> 106 <i><font color='green'> * packet_receive_register</font></i>
<a name='L107'> 107 <i><font color='green'> *</font></i>
<a name='L108'> 108 <i><font color='green'> * Register a callback function to receive packets from ports in</font></i>
<a name='L109'> 109 <i><font color='green'> * this datapath</font></i>
<a name='L110'> 110 <i><font color='green'> */</font></i>
<a name='L111'> 111 <b>int</b>
<a name='L112'> 112 <a href='../R/3784.html' title='Multiple refered from 2 places.'>of_hw_packet_receive_register</a>(<a href='../S/183.html#L69' title='Defined at 69 in cbench/openflow/include/openflow/of_hw_api.h.'>of_hw_driver_t</a> *<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>,
<a name='L113'> 113                               <a href='../Y/5054.html' title='Multiple used in 5 places.'>of_packet_in_f</a> <a href='../Y/1775.html' title='Multiple used in 63 places.'>callback</a>, <b>void</b> *<a href='../Y/2133.html' title='Multiple used in 81 places.'>cookie</a>)
<a name='L114'> 114 <font color='red'>{</font>
<a name='L115'> 115     <a href='../S/222.html#L87' title='Defined at 87 in cbench/openflow/hw-lib/skeleton/hw_drv.h.'>of_hw_driver_int_t</a> *<a href='../Y/2523.html' title='Multiple used in 8 places.'>dp_int</a>;
<a name='L116'> 116     <b>int</b> <a href='../Y/6512.html' title='Multiple used in 34 places.'>rv</a>;
<a name='L117'> 117 
<a name='L118'> 118     <i><font color='green'>/* Register for link status changes */</font></i>
<a name='L119'> 119     <b>if</b> (!<a href='../Y/6543.html' title='Multiple used in 3 places.'>rx_registered</a>) <font color='red'>{</font>
<a name='L120'> 120         <i><font color='green'>/* Set up low level pkt receive for callback */</font></i>
<a name='L121'> 121         <a href='../Y/6543.html' title='Multiple used in 3 places.'>rx_registered</a> = 1;
<a name='L122'> 122     <font color='red'>}</font>
<a name='L123'> 123 
<a name='L124'> 124     <a href='../Y/2523.html' title='Multiple used in 8 places.'>dp_int</a> = (<a href='../S/222.html#L87' title='Defined at 87 in cbench/openflow/hw-lib/skeleton/hw_drv.h.'>of_hw_driver_int_t</a> *)<a href='../Y/3685.html' title='Multiple used in 131 places.'>hw_drv</a>;
<a name='L125'> 125     <a href='../Y/2523.html' title='Multiple used in 8 places.'>dp_int</a>-&gt;<a href='../Y/6523.html' title='Multiple used in 4 places.'>rx_handler</a> = <a href='../Y/1775.html' title='Multiple used in 63 places.'>callback</a>;
<a name='L126'> 126     <a href='../Y/2523.html' title='Multiple used in 8 places.'>dp_int</a>-&gt;<a href='../Y/6516.html' title='Multiple used in 3 places.'>rx_cookie</a> = <a href='../Y/2133.html' title='Multiple used in 81 places.'>cookie</a>;
<a name='L127'> 127 
<a name='L128'> 128     <b>return</b> 0;
<a name='L129'> 129 <font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L15'>[^]</a><a href='#L112'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
